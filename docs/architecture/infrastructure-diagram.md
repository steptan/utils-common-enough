# Infrastructure Architecture Diagrams

## AWS Infrastructure Overview

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                   Internet                                   │
└───────────────────────────────────┬─────────────────────────────────────────┘
                                    │
                          ┌─────────▼──────────┐
                          │   Route 53 DNS     │
                          └─────────┬──────────┘
                                    │
                          ┌─────────▼──────────┐
                          │  CloudFront CDN    │
                          │  + WAF Rules       │
                          └──┬──────────────┬──┘
                             │              │
                   ┌─────────▼───┐    ┌─────▼────────┐
                   │  S3 Static  │    │ API Gateway  │
                   │   Assets    │    │  REST API    │
                   └─────────────┘    └──────┬───────┘
                                             │
┌────────────────────────────────────────────┼───────────────────────────────┐
│                                    VPC     │                                │
│  ┌─────────────────────────────────────────┼─────────────────────────────┐ │
│  │                          Public Subnets  │                             │ │
│  │  ┌────────────┐  ┌────────────┐  ┌─────▼──────┐  ┌────────────┐     │ │
│  │  │  NAT GW    │  │  NAT GW    │  │   ALB      │  │  Bastion   │     │ │
│  │  │   (AZ1)    │  │   (AZ2)    │  │ (Optional) │  │   Host     │     │ │
│  │  └──────┬─────┘  └─────┬──────┘  └─────┬──────┘  └────────────┘     │ │
│  └─────────┼──────────────┼───────────────┼─────────────────────────────┘ │
│            │              │               │                                 │
│  ┌─────────┼──────────────┼───────────────┼─────────────────────────────┐ │
│  │         │   Private Subnets            │                              │ │
│  │  ┌──────▼─────┐  ┌─────▼──────┐  ┌────▼───────┐  ┌────────────┐     │ │
│  │  │  Lambda    │  │  Lambda    │  │   Lambda   │  │    RDS     │     │ │
│  │  │ Functions  │  │ Functions  │  │ Functions  │  │ (Optional) │     │ │
│  │  │   (AZ1)    │  │   (AZ2)    │  │   (AZ3)    │  │            │     │ │
│  │  └──────┬─────┘  └─────┬──────┘  └────┬───────┘  └─────┬──────┘     │ │
│  └─────────┼──────────────┼───────────────┼────────────────┼────────────┘ │
│            │              │               │                 │               │
│  ┌─────────▼──────────────▼───────────────▼─────────────────▼────────────┐ │
│  │                         VPC Endpoints                                  │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │ │
│  │  │  DynamoDB   │  │     S3      │  │    SSM      │  │   Secrets   │  │ │
│  │  │  Endpoint   │  │  Endpoint   │  │  Endpoint   │  │  Manager    │  │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────────────────────────────────┘
                                    │
                          ┌─────────▼──────────┐
                          │    DynamoDB        │
                          │    Tables          │
                          └────────────────────┘
```

## Lambda Function Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                            Lambda Function                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────┐     ┌──────────────┐     ┌────────────────┐             │
│  │   Handler   │────▶│   Business   │────▶│  Data Access   │             │
│  │   Layer     │     │    Logic     │     │     Layer      │             │
│  └─────────────┘     └──────────────┘     └───────┬────────┘             │
│                                                    │                        │
│  ┌─────────────────────────────────────────────────┼──────────────────┐   │
│  │                  Lambda Layers                  │                   │   │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────▼────────────┐     │   │
│  │  │   Common   │  │   AWS SDK  │  │   Database Drivers      │     │   │
│  │  │ Libraries  │  │  (Latest)  │  │   (PostgreSQL/MySQL)    │     │   │
│  │  └────────────┘  └────────────┘  └──────────────────────────┘     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  Environment Variables                    Secrets                           │
│  ┌──────────────────┐                   ┌──────────────────┐              │
│  │ • API_ENDPOINT   │                   │ • DB_PASSWORD    │              │
│  │ • TABLE_NAME     │                   │ • API_KEYS       │              │
│  │ • ENVIRONMENT    │                   │ • JWT_SECRET     │              │
│  └──────────────────┘                   └──────────────────┘              │
└─────────────────────────────────────────────────────────────────────────────┘
```

## DynamoDB Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          DynamoDB Tables                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌───────────────────────────────────────────────────────────────────┐     │
│  │                     Main Table (Users/Items)                       │     │
│  ├───────────────────────────────────────────────────────────────────┤     │
│  │  Partition Key: user_id        Sort Key: item_id                  │     │
│  │  ┌─────────┬─────────┬─────────┬─────────┬─────────────────────┐ │     │
│  │  │ user_id │ item_id │  name   │  data   │    timestamps       │ │     │
│  │  ├─────────┼─────────┼─────────┼─────────┼─────────────────────┤ │     │
│  │  │ user123 │ item001 │ "Item1" │  {...}  │ created: 2024-01-20 │ │     │
│  │  │ user123 │ item002 │ "Item2" │  {...}  │ updated: 2024-01-21 │ │     │
│  │  └─────────┴─────────┴─────────┴─────────┴─────────────────────┘ │     │
│  └───────────────────────────────────────────────────────────────────┘     │
│                                                                             │
│  ┌───────────────────────────────────────────────────────────────────┐     │
│  │                    Global Secondary Index (GSI)                    │     │
│  ├───────────────────────────────────────────────────────────────────┤     │
│  │  Partition Key: status         Sort Key: created_at               │     │
│  │  ┌─────────┬──────────────┬─────────┬─────────────────────────┐ │     │
│  │  │ status  │  created_at  │ user_id │      item_id            │ │     │
│  │  ├─────────┼──────────────┼─────────┼─────────────────────────┤ │     │
│  │  │ active  │ 2024-01-20   │ user123 │      item001            │ │     │
│  │  │ pending │ 2024-01-21   │ user456 │      item003            │ │     │
│  │  └─────────┴──────────────┴─────────┴─────────────────────────┘ │     │
│  └───────────────────────────────────────────────────────────────────┘     │
│                                                                             │
│  Features:                                                                  │
│  • On-Demand Billing        • Point-in-Time Recovery                       │
│  • Auto Scaling             • DynamoDB Streams → Lambda                    │
│  • Encryption at Rest       • Global Tables (Multi-Region)                 │
└─────────────────────────────────────────────────────────────────────────────┘
```

## S3 Bucket Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                            S3 Bucket Structure                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  {project}-{environment}-assets/                                            │
│  ├── static/                     # CloudFront Origin                       │
│  │   ├── css/                                                              │
│  │   ├── js/                                                               │
│  │   └── images/                                                           │
│  │                                                                          │
│  ├── uploads/                    # User Uploads                            │
│  │   ├── {user-id}/                                                        │
│  │   │   ├── images/                                                       │
│  │   │   └── documents/                                                    │
│  │   └── temp/                   # Temporary files                         │
│  │                                                                          │
│  └── backups/                    # Automated Backups                       │
│      ├── database/                                                         │
│      └── config/                                                           │
│                                                                             │
│  Bucket Policies:                                                          │
│  ┌────────────────────────────────────────────────────────────────┐       │
│  │ • CloudFront OAI Read Access on /static                        │       │
│  │ • Lambda Execution Role Read/Write on /uploads                 │       │
│  │ • Backup Role Write on /backups                                │       │
│  │ • Lifecycle: Move to Glacier after 90 days for /backups        │       │
│  └────────────────────────────────────────────────────────────────┘       │
└─────────────────────────────────────────────────────────────────────────────┘
```

## API Gateway Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           API Gateway Structure                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  /api                                                                       │
│  ├── /users                      ┌─────────────────┐                       │
│  │   ├── GET    ────────────────▶│ Lambda: GetUser │                       │
│  │   ├── POST   ────────────────▶│ Lambda: AddUser │                       │
│  │   └── /{id}                   └─────────────────┘                       │
│  │       ├── GET  ──────────────▶┌──────────────────┐                     │
│  │       ├── PUT  ──────────────▶│ Lambda: GetUserID│                     │
│  │       └── DELETE ────────────▶└──────────────────┘                     │
│  │                                                                          │
│  ├── /items                      ┌──────────────────┐                      │
│  │   ├── GET    ────────────────▶│ Lambda: GetItems │                      │
│  │   └── POST   ────────────────▶│ Lambda: AddItem  │                      │
│  │                               └──────────────────┘                      │
│  └── /auth                                                                  │
│      ├── /login ────────────────▶┌──────────────────┐                     │
│      └── /refresh ──────────────▶│ Lambda: Auth     │                     │
│                                  └──────────────────┘                      │
│                                                                             │
│  Features:                                                                  │
│  ┌────────────────────────────────────────────────────────────────┐       │
│  │ • Request/Response Validation  • API Keys & Usage Plans        │       │
│  │ • CORS Configuration          • Request/Response Mapping       │       │
│  │ • Throttling (10k req/s)      • CloudWatch Logging            │       │
│  │ • Custom Authorizers          • VPC Link for Private APIs      │       │
│  └────────────────────────────────────────────────────────────────┘       │
└─────────────────────────────────────────────────────────────────────────────┘
```

## Security Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                            Security Layers                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  1. Edge Security (CloudFront + WAF)                                        │
│  ┌────────────────────────────────────────────────────────────────┐       │
│  │ • DDoS Protection (Shield)    • Geo-blocking                   │       │
│  │ • Rate Limiting               • SQL Injection Protection       │       │
│  │ • XSS Protection              • Bot Detection                  │       │
│  └────────────────────────────────────────────────────────────────┘       │
│                                                                             │
│  2. API Security (API Gateway)                                              │
│  ┌────────────────────────────────────────────────────────────────┐       │
│  │ • API Key Validation          • OAuth 2.0 / JWT                │       │
│  │ • Request Throttling          • IP Whitelisting                │       │
│  │ • Custom Authorizers          • Request Validation             │       │
│  └────────────────────────────────────────────────────────────────┘       │
│                                                                             │
│  3. Application Security (Lambda)                                           │
│  ┌────────────────────────────────────────────────────────────────┐       │
│  │ • IAM Roles (Least Privilege) • Secrets Manager                │       │
│  │ • VPC Security Groups         • Input Validation               │       │
│  │ • Environment Isolation       • Dependency Scanning            │       │
│  └────────────────────────────────────────────────────────────────┘       │
│                                                                             │
│  4. Data Security                                                           │
│  ┌────────────────────────────────────────────────────────────────┐       │
│  │ • Encryption at Rest (AES-256) • Encryption in Transit (TLS)   │       │
│  │ • KMS Key Management           • Data Masking                  │       │
│  │ • Backup Encryption            • Access Logging                │       │
│  └────────────────────────────────────────────────────────────────┘       │
└─────────────────────────────────────────────────────────────────────────────┘
```

## Cost Optimization Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         Cost Optimization Strategy                           │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  Compute Optimization                Storage Optimization                   │
│  ┌──────────────────┐              ┌──────────────────┐                   │
│  │ • Lambda ARM64   │              │ • S3 Lifecycle    │                   │
│  │ • Right-sizing   │              │ • Intelligent Tier│                   │
│  │ • Reserved Conc. │              │ • Glacier Archive │                   │
│  └──────────────────┘              └──────────────────┘                   │
│                                                                             │
│  Data Transfer                      Monitoring                              │
│  ┌──────────────────┐              ┌──────────────────┐                   │
│  │ • VPC Endpoints  │              │ • Cost Explorer   │                   │
│  │ • CloudFront     │              │ • Budget Alerts   │                   │
│  │ • Compression    │              │ • Anomaly Detect  │                   │
│  └──────────────────┘              └──────────────────┘                   │
│                                                                             │
│  Cost Allocation                                                            │
│  ┌────────────────────────────────────────────────────────────────┐       │
│  │ Tags: Project={project}, Environment={env}, Owner={team}       │       │
│  └────────────────────────────────────────────────────────────────┘       │
└─────────────────────────────────────────────────────────────────────────────┘
```
